model User {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String
  emailVerified Boolean  @default(false)
  image         String?
  status        Int      @default(1)
  modifiedAt    DateTime @default(now())
  createdAt     DateTime @default(now())
  role          String?
  updatedBy     String?  @db.ObjectId
  parentId      String?  @db.ObjectId // Upline (formerly createdBy)

  // Wallet fields per spec
  balance          Float  @default(0) // Real money
  exposure         Float  @default(0) // Sum of max loss on open bets (always negative)
  creditReference  Float? @default(0) // Max loss allowed by upline
  exposureLimit    Float? @default(0) // Hard cap on exposure
  commissionEarned Float  @default(0) // Total commission earned

  // Legacy/tracking fields
  deposit_amt            Float?
  withdraw_amt           Float?
  sportsList             UserSportsList[]
  updatedAt              DateTime                 @updatedAt
  upLineCommisionPercent Float?                   @default(0)
  openingBalance         Float?                   @default(0)
  mobileNumber           String?
  partnership            String?
  rollingCommission      RollingCommissionConfig?
  agentRollingCommission RollingCommissionConfig?
  isLocked               Boolean                  @default(false)
  lockReason             String?
  deletedAt              DateTime?
  deletedBy              String?                  @db.ObjectId

  // Better Auth Admin Plugin Fields
  banned     Boolean   @default(false)
  banReason  String?
  banExpires DateTime?

  @@map("users")
}

type NotificationStatus {
  ptop        Int @default(1)
  supportChat Int @default(1)
}

type UserSportsList {
  game   String?
  status Boolean?
}

model UserLogin {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  user_id   String?
  ipaddress String?
  city      String?
  country   String?
  status    Boolean?
  type      String?
  browser   String?
  os        String?
  createdAt DateTime @default(now())

  @@map("user_logins")
}

model IpTracker {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  ip        String?
  time      Json?
  block     Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("iptrackers")
}

model TransactionHistory {
  id                String           @id @default(auto()) @map("_id") @db.ObjectId
  sender_id         String?
  sender_name       String?
  sender_role       Int?
  receiver_role     Int?
  amount            Float?
  receiver_id       String?
  receiver_name     String?
  type              TransactionType?
  remaining_balance Float?
  from_to           Int?
  remarks           String?
  user_id           String?          @db.ObjectId
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  @@map("transaction_histories")
}

type RollingCommissionConfig {
  fancy         Int? @default(0)
  matka         Int? @default(0)
  casino        Int? @default(0)
  binary        Int? @default(0)
  sportbook     Int? @default(0)
  line          Int? @default(0)
  bookmaker     Int? @default(0)
  virtualSports Int? @default(0)
}
